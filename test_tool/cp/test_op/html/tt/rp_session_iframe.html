<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

<script type="application/javascript">
    var client_id = "{client_id}";
    var session_state = "{session_state}";
    console.log("RP session state: " + session_state);
    var targetOrigin = "{issuer}";

    var mes = client_id + " " + session_state;

    window.addEventListener("message", receiveMessage, false);
    checkSession();
    console.log("RP iframe, starting timer.");
    var timer_id = setInterval(checkSession, 1000);

    function checkSession() {
        var win = window.parent.document.getElementById("op_iframe").contentWindow;
        win.postMessage(mes, targetOrigin);
    }

    function receiveMessage(e) {
        console.log("origin: " + e.origin + " expected: " + targetOrigin);
        if (e.origin !== targetOrigin) {
            return;
        }
        window.parent.window.location.href = "{service_url}" + "?state=" + e.data;
    }
</script>

</body>
</html>